什么是PBR
那它为什么不叫物理渲染（Physical Rendering）呢？
物理渲染（Physical Rendering）是指跟真实世界完全一致的计算机渲染效果。
为了回答这个问题，先了解一下真实世界的成相原理。
真实世界的物体有着各自的材质属性和表面特征，它们受到各种局部灯光和全局环境光的影响，而且它们之间又相互影响，
最终这些信息通过光波的形式进入复杂的人眼构造，刺激视神经形成生物信号进入大脑感光皮层，最终让人产生视觉认知。
基于现阶段的知识水平和硬件水平，还不能渲染跟真实世界完全一致的效果，只能一定程序上模拟接近真实世界的渲染画面，故而叫基于物理的渲染
为什么选择PBR
这里我们再回顾下早期CG行业引入PBR的时代背景，简言之就是项目组被复杂度压垮了。
当时也是shader等由艺术家来主导，怎么好看怎么来，在简单地动画拍起来没问题，然后动画变得越来越复杂，材质、场景、时段都在猛烈的增加，然后项目组就崩溃了。
白天好的材质，到了晚上就不行了，换个视角就不行了。
然后开始PBR，事情就简单了。
其背后的原因，就是面对超大规模超高复杂度，就要有一个坚实的数学基础。
而没有数学正确的hack，则如同不能放之四海皆准的道理一样，本地可以，换个情况就“不准”了。
为什么选择PBR2
相比传统的Lambert着色和Phong
着色，PBR着色在效果上有着质的提升，可以表示更多更复杂的材质特征：
表面细节 物体粗糙度 区别明显的金属和绝缘体 物体的浑浊程度 菲涅尔现象：不同角度有不同强度的反射光 半透明物体 多层混合材质 清漆效果 其它更复杂的表面特征

Phong模型着色效果，只能简单地表现理想模型的漫反射和高光，渲染出的效果跟真实世界相差甚远。
它们真实地渲染出各类材质的粗糙、纹理、高光、清漆、边缘光等等表面细节特征
在SIGGRAPH 2012会议上，工作于迪斯尼动画工作室的Brent Burly演讲了著名的主题：《Physically Based Shading at Disney》。他提出了迪斯尼原则的BRDF（Disney Principled BRDF），奠定了后续游戏行业和电影行业PBR的方向和标准。后续的主流游戏引擎，3D渲染器及动画制作软件大多基于此方案或变种实现的。迪斯尼原则的BRDF用少量简单易懂的参数和高度完善的美术工作流程，大大简化了此前复杂的PBR的参数和制作流程。它是艺术导向（Art Directable）的着色模型，而不完全是物理正确（Physically Correct）。由于其高度的易用性以及方便的工作流，已经被电影和游戏业界广泛使用，并成为了次时代高品质渲染技术的代名词。
推动了这次基于物理的渲染革命的“迪士尼原则的BRDF(Disney Principled BRDF)”
微平面模型
达到微观尺度之后任何平面都可以用被称为微平面的细小镜面来进行描绘。根据平面粗糙程度的不同，这些细小镜面的取向排列可
产生的效果就是：一个平面越是粗糙，这个平面上的微平面的排列就越混乱。这些微小镜面这样无序取向排列的影响就是，当我们特指镜面光/镜面反射时，入射光线更趋向于向完全不同的方向发散开来，进而产生出分布范围更广泛的镜面反射。而与之相反的是，对于一个光滑的平面，光线大体上会更趋向于向同一个方向反射，造成更小更锐利的反射以很不一致。
在微观尺度下，没有任何平面是完全光滑的
漫反射与镜面反射
正态分布函数D：估算在受到表面粗糙度的影响下，取向方向与中间向量一致的微平面的数量。这是用来估算微平面的主要函数。
几何函数G：描述了微平面自成阴影的属性。当一个平面相对比较粗糙的时候，平面表面上的微平面有可能挡住其他的微平面从而减少表面所反射的光线。
菲涅尔方程F：菲涅尔方程描述的是在不同的表面角下表面所反射的光线所占的比率。
以上的每一种函数都是用来估算相应的物理参数的，而且你会发现用来实现相应物理机制的每种函数都有不止一种形式。它们有的非常真实，有的则性能高效。你可以按照自己的需求任意选择自己想要的函数的实现方法。英佩游戏公司的Brian Karis对于这些函数的多种近似实现方式进行了大量的研究。我们将会采用Epic Games在Unreal Engine 4中所使用的函数，其中D使用Trowbridge-Reitz GGX，F使用Fresnel-Schlick近似(Fresnel-Schlick Approximation)，而G使用Smith’s Schlick-GGX。
菲涅尔效应与菲涅尔方程
菲涅尔方程描述的是被反射的光线对比光线被折射的部分所占的比率，这个比率会随着我们观察的角度不同而不同。当光线碰撞到一个表面的时候，菲涅尔方程会根据观察角度告诉我们被反射的光线所占的百分比。
当垂直观察的时候，任何物体或者材质表面都有一个基础反射率(Base Reflectivity)，但是如果以一定的角度往平面上看的时候所有反光都会变得明显起来。
正态分布函数
目前有很多种NDF都可以从统计学上来估算微平面的总体取向度，用得比较广泛的是Trowbridge-Reitz GGX
如果我们把h当成是不同粗糙度参数下，平面法向量和光线方向向量之间的中间向量的话，我们可以得到如图示的效果：
当粗糙度很低（也就是说表面很光滑）的时候，与中间向量取向一致的微平面会高度集中在一个很小的半径范围内。由于这种集中性，NDF最终会生成一个非常明亮的斑点。但是当表面比较粗糙的时候，微平面的取向方向会更加的随机。与h向量取向一致的微平面分布在一个大得多的半径范围内，但是同时较低的集中性也会让我们的最终效果显得更加灰暗。
几何函数
几何函数从统计学上近似的求得了微平面间相互遮蔽的比率，这种相互遮蔽会损耗光线的能量。几何函数采用一个材料的粗糙度参数作为输入参数，粗糙度较高的表面其微平面间相互遮蔽的概率就越高
这里的k是α基于几何函数针对直接光照还是针对IBL光照的重映射



